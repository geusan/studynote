# 데이터베이스 튜터링
===================

2017.10.19 네번째

> 이론에 질문이 있으면 받기로 결정



### 오늘의 SQL : VIEW를 만들어서 참조 테이블 만들기
우리는 테이블 여러개의 관계를 만들어서 관계형 데이터 베이스를 만들었다. 근데 유독 특이적인 테이블 몇개를 자주 조인하여 사용하고 있다. 이때, 이들을 좀 더 간단히 쓰고 싶다는 게으른 생각에서 생겨난 것이 VIEW이다. VIEW는 여러개의 테이블을 조인해서 새로운 테이블을 만든 것이다. 자주 쓰는 테이블들이 정해져있다면 이들을 묶어서 VIEW라는 것으로 만들어 놓고 테이블 대신 이 VIEW를 가져다가 쓰면 더 간단하고 빠르게 데이터를 가져올 수 있게된다.

- VIEW를 선언하는 방법은 다음과 같다.
```
    CREATE VIEW 뷰이름 AS
    SELECT 컬럼1, 컬럼2...
    FROM 테이블1, 테이블2...
    WHERE 조건
```

이를 실행하면 조건에 맞게 특정 테이블의 특정 컬럼을 모든 뷰가 생성이 되고 테이블과 데이터는 연동이 되게 된다. *쉽게 생각하면 조인문을 미리 지정해 놓은 것이라고 생각하면 좀더 편하다.*

- VIEW를 수정하는 방법
```
    CREATE OR REPLACE VIEW 뷰이름 AS
    SELECT 컬럼1, 컬럼2...
    FROM 테이블1, 테이블2...
    WHERE 조건
```
- VIEW를 삭제하는 방법
```
    DROP VIEW 뷰이름
```


#### 중간고사에 뭐가 나올까?

1. SQL문 작성하기
2. 요구조건 분석 및 설계
3. ERD를 데이터베이스로 바꾸기

정도로 예상된다.<span style="text-decoration:line-through;">(안나와도 내책임아님ㅎ)</span>

- SQL 읽기1
```
SELECT name, age
FROM students
WHERE name LIKE 'a%';
```


- SQL 읽기2
```
SELECT name, age
FROM students
LEFT OUTER JOIN classes ON students.class = classes.classId
WHERE EXISTS (SELECT name FROM teachers WHERE teachers.class = 'haebaragi');
```

- SQL 읽기3
```
SELECT age as nai, name as erum, sum(age)
FROM students AS s1, students AS s2
WHERE s1.age = s2.age AND s1.name <> s2.name OR s1.class IS NOT NULL;
```

- 요구조건 분석부터 SQL만들기까지

    - 대한민국 영화계를 책임지는 귺산영화사가 있다. 귺산영화사에서는 제작된 영화들을 데이터베이스로 관리하고 있다. 각 영화들은 영화감독, 개봉연도, 주연배우, 제작비 정보를 가지고 있고, 영화사에 소속된 영화 감독은 이름, 나이, 출신학교, 전공 등의 정보를 가지고 있으며, 출연 배우들은 대뷔연도, 연봉, 이름, 나이 등의 정보를 가지고 있어서 각각의 테이블을 만들어서 관리를 하고 있다. 감독과 출연 배우들은 영화라는 관계로 설명할 수 있다. 다음의 표가 각 이름당 데이터 베이스들을 말하는 것이다.

    - 테이블 정보는 아래와 같다.

|테이블 이름|컬럼명|
|:-:|:-:|
|영화|감독, 개봉연도, 주연배우, 제작비|
|감독|이름, 나이, 출신학교, 전공|
|배우|이름, 나이 ,데뷔연도, 좋아하는 음식, 연봉|

- 위의 테이블과 요구조건을 보고 SQL문을 작성해보자

    - 동국대학교 출신 감독이 찍은 영화 제목, 연도, 주연배우, 제작비

    - 주연배우 "원빈"이 출연한 영화중 1997년 이후 찍은 영화감독 다섯명

    - "김치"라는 글자가 들어있는 음식을 좋아하는 영화배우와 "생물학"을 전공한 감독이 찍은 영화들을 제작비 내림차순으로 정렬


- 요구조건에서 ERD 그리고 데이터베이스 설계하기

    - 귺산은행에서는 고객들과 소통하기를 좋아한다. 전국의 모든 도시에 은행이 있고, 각 은행은 고유번호와 함께 지역과 전화번호가 있다. 은행에서는 고객들의 돈을 관리한다. 고객은 예금 적금도 들 수 있지만, 대출이 주목적이다. 은행의 주 수입원은 대출인데, 한 은행에서 한 고객 대출을 받을 수 있는 횟수는 1회뿐이기 때문에, 고객들은 여러 지점의 은행을 돌아다니며 대출을 한다. 은행에서 은행지점과 고객들을 관리하는 데이터베이스를 만들고 싶어서 귺산소프트웨어로 의뢰를 하게 되었다. 다음 문제에 답해보자

        1. 귺산 은행의 데이터 베이스를 ERD로 표현해보자
        2. 1.에서 만든 ERD를 바탕으로 데이터베이스를 설계해보자
        3. 2.에서 만든 데이터베이스 테이블을 만드는 SQL문을 작성해보자
        4. 테이블에서 은행과 고객이 하나의 관계를 가진다고 가정했을 때, 관계들을 볼 수 있는 SQL문과 관계가 생성되고, 수정되고, 삭제되는 SQL문을 작성해보자
